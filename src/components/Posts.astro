---
import Post from "./Post.astro";

interface PostFrontmatter {
  title: string;
  description: string;
  tags?: string[];
  pubDate: string;
}

interface PostModule {
  url?: string;
  frontmatter: PostFrontmatter;
}

const posts = import.meta.glob<PostModule>("../pages/blog/*.mdx");
const allPosts = await Promise.all(
  Object.values(posts).map((importFn) => importFn())
);
---

<div class="not-prose flex flex-col gap-4">
  {
    allPosts
      .sort((a, b) => {
        return (
          new Date(b.frontmatter.pubDate).getTime() - new Date(a.frontmatter.pubDate).getTime()
        );
      })
      .map((post) => (
        <Post
          href={post.url}
          title={post.frontmatter.title}
          description={post.frontmatter.description}
          tags={post.frontmatter.tags}
          pubDate={post.frontmatter.pubDate}
        />
      ))
  }
</div>
